<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DSCPL AI</title>
    <!-- 1. Include Tailwind CSS from a CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Include React and Babel to run React in the browser -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- CSS for custom animations -->
    <style>
        @keyframes slide-in-fwd {
            0% { transform: translateX(-80px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes bounce-in {
            0% { transform: scale(0.95); opacity: 0; }
            80% { transform: scale(1.02); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fade-in {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        /* NEW: Animation for the breathing guide */
        @keyframes breathing-animation {
            0% { transform: scale(0.8); } /* Start small */
            33% { transform: scale(1.2); } /* Inhale for 4s */
            66% { transform: scale(1.2); } /* Hold for 4s */
            100% { transform: scale(0.8); } /* Exhale for 4s */
        }
        .animate-breathing {
            animation: breathing-animation 12s ease-in-out infinite;
        }
        .animate-slide-in-fwd { animation: slide-in-fwd 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both; }
        .animate-bounce-in { animation: bounce-in 0.4s ease-out both; }
        .animate-fade-in { animation: fade-in 0.6s ease-in both; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 3. Your React App Code, processed by Babel -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- SVG Icons --- //
        const LogoIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M10.43 5.24a5.26 5.26 0 1 0-6.26 6.26 6.26 0 1 1 8.31 8.31l-4.12-4.12"/>
                <path d="M12.53 8.47a2.5 2.5 0 1 1-3.54-3.54"/>
                <path d="M18 16.58a4.5 4.5 0 0 0-6.36-6.36"/>
                <path d="M13.5 17.5s-1-2-3-2-3.5 1.5-3.5 1.5"/>
                <path d="m22 2-1.5 1.5"/>
            </svg>
        );

        const SendIcon = () => (
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor" className="h-6 w-6">
                <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
            </svg>
        );
        
        const CalendarIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );
        
        // --- App Configuration --- //
        const modes = {
            devotion: { 
                label: "Devotion", 
                welcome: "Choose a focus for your devotion.",
                options: {
                    "Adoration": { title: "Adoration", description: "Praise God for who He is.", prompt: "Let's spend time in adoration. What attributes of God do you want to praise today?" },
                    "Confession": { title: "Confession", description: "Honestly repent and seek forgiveness.", prompt: "This is a safe space for confession. What would you like to bring before God?" },
                    "Thanksgiving": { title: "Thanksgiving", description: "Express gratitude for your blessings.", prompt: "Let's give thanks. What are you grateful for today?" },
                    "Supplication": { title: "Supplication", description: "Bring your requests to God.", prompt: "Let's bring our requests to God. What is on your heart to ask for?" },
                    "Daily Prayer Focus": { title: "Daily Prayer Focus", description: "Receive a prompt to guide your prayer.", prompt: "Today's focus is on praying for others. Who comes to mind that we can lift up in prayer?" }
                }
            },
            prayer: { 
                label: "Prayer", 
                welcome: "Choose an activity for your prayer.",
                options: {
                    "Bible Reading": "Receive a verse for today.",
                    "Short Prayer": "Receive a prayer to guide you.",
                    "Faith Declaration": "Declare truth over your life."
                }
            },
            meditation: { 
                label: "Meditation", 
            },
            accountability: { 
                label: "Accountability", 
                welcome: "Choose an option for accountability.",
                options: {
                    "Scripture for Strength": { title: "Scripture for Strength", description: "Receive a verse to strengthen you against temptation." },
                    "Truth Declarations": { title: "Truth Declarations", description: "Speak truth over your situation.", prompt: "Let's declare truth. What lie are you fighting against right now?" },
                    "Alternative Actions": { title: "Alternative Actions", description: "Find a healthy alternative to temptation.", prompt: "Let's find a better path. What temptation are you facing?" },
                    "SOS Feature": { title: "SOS - I Need Help Now", description: "Get immediate encouragement and an action plan." }
                }
            },
        };

        const generalWeeklyPlan = {
            goal: "This 7-day program is a balanced guide to help you connect with your spiritual side through daily, focused actions.",
            plan: [
                { day: 1, title: "Mindful Morning", description: "Start your day with 10 minutes of quiet reflection or prayer." },
                { day: 2, title: "Express Gratitude", description: "Write down three things you are thankful for today." },
                { day: 3, title: "Act of Kindness", description: "Do something kind for a stranger or a loved one." },
                { day: 4, title: "Read & Reflect", description: "Spend 15 minutes reading a spiritual text or book." },
                { day: 5, title: "Connect with Nature", description: "Take a short walk and appreciate the world around you." },
                { day: 6, title: "Digital Detox", description: "Set aside one hour without screens before bed." },
                { day: 7, title: "Weekly Review", description: "Think about your journey and set an intention for next week." },
            ]
        };
        
        const BreathingGuide = () => {
            const [text, setText] = useState("Inhale");

            useEffect(() => {
                const cycle = () => {
                    setText("Inhale");
                    setTimeout(() => setText("Hold"), 4000);
                    setTimeout(() => setText("Exhale"), 8000);
                };
                cycle();
                const interval = setInterval(cycle, 12000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="relative w-48 h-48 flex items-center justify-center">
                    <div className="absolute w-full h-full bg-amber-light/20 rounded-full animate-breathing"></div>
                    <p className="text-2xl font-semibold text-coffee-dark z-10">{text}</p>
                </div>
            );
        };

        // --- Main App Component --- //
        function App() {
            const [view, setView] = useState('home'); 
            const [mode, setMode] = useState(null); 
            const [topic, setTopic] = useState("");
            const [activeProgram, setActiveProgram] = useState(null); 
            const [input, setInput] = useState("");
            const [conversation, setConversation] = useState([]);
            const [loading, setLoading] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [generatedContent, setGeneratedContent] = useState({});
            const chatEndRef = useRef(null);

            const handleModeChange = async (newMode) => {
                setMode(newMode);
                // FIXED: Corrected the typo 'devitation' to 'devotion'
                if (newMode === 'devotion') {
                    setView('devotion-options');
                } else if (newMode === 'prayer') {
                    setView('prayer-options');
                } else if (newMode === 'accountability') {
                    setView('accountability-options');
                } else if (newMode === 'meditation') {
                    setIsGenerating(true);
                    setView('meditation-structured');
                    try {
                        const res = await fetch("http://localhost:5000/chat", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ requestType: 'meditation_scripture' }),
                        });
                        if (!res.ok) throw new Error("Server error");
                        const data = await res.json();
                        if (data.reply) {
                            setGeneratedContent({ type: 'verse', data: data.reply });
                        } else {
                            throw new Error("Invalid response");
                        }
                    } catch (error) {
                        console.error("Fetch error:", error);
                        setGeneratedContent({ type: 'error', data: 'Could not load scripture. Please try again.' });
                    } finally {
                        setIsGenerating(false);
                    }
                }
            };
            
            const handlePrayerOption = async (option) => {
                if (option === 'Faith Declaration') {
                    setTopic('Faith Declaration');
                    setConversation([{ sender: "bot", text: "Let's declare some truths together. What's on your heart to affirm today?" }]);
                    setView('chat');
                    return;
                }
                setIsGenerating(true);
                let requestType = option === 'Bible Reading' ? 'bible_verse' : 'short_prayer';
                try {
                    const res = await fetch("http://localhost:5000/chat", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ requestType: requestType }),
                    });
                    if (!res.ok) throw new Error("Server error");
                    const data = await res.json();
                    if (data.reply) {
                        setGeneratedContent({ type: requestType === 'bible_verse' ? 'verse' : 'prayer', data: data.reply });
                        setView('content-display');
                    } else { throw new Error("Invalid response"); }
                } catch (error) {
                    console.error("Fetch error:", error);
                    setGeneratedContent({ type: 'error', data: 'Sorry, I couldn\'t generate content right now. Please try again.' });
                    setView('content-display');
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleDevotionOption = (optionKey) => {
                const selectedOption = modes.devotion.options[optionKey];
                setTopic(selectedOption.title);
                setConversation([{ sender: "bot", text: selectedOption.prompt }]);
                setView('chat');
            };

            const handleAccountabilityOption = async (optionKey) => {
                const option = modes.accountability.options[optionKey];
                if (option.prompt) {
                    setTopic(option.title);
                    setConversation([{ sender: "bot", text: option.prompt }]);
                    setView('chat');
                } else if (optionKey === 'Scripture for Strength') {
                    setIsGenerating(true);
                    try {
                        const res = await fetch("http://localhost:5000/chat", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ requestType: 'scripture_for_strength' }),
                        });
                        if (!res.ok) throw new Error("Server error");
                        const data = await res.json();
                        if (data.reply) {
                            setGeneratedContent({ type: 'verse', data: data.reply });
                            setView('content-display');
                        } else { throw new Error("Invalid response"); }
                    } catch (error) {
                        console.error("Fetch error:", error);
                        setGeneratedContent({ type: 'error', data: 'Sorry, I couldn\'t generate a scripture right now. Please try again.' });
                        setView('content-display');
                    } finally {
                        setIsGenerating(false);
                    }
                } else if (optionKey === 'SOS Feature') {
                    setView('sos-display');
                }
            };

            const handleWeeklyPlanClick = () => {
                if (activeProgram) { setView('weekly-plan-display'); } else { setView('weekly-plan-prompt'); }
            };
            const handleProgramStart = () => {
                setActiveProgram({ day: 1 });
                setView('weekly-plan-display');
            };

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [conversation, loading]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim() || loading) return;
                const userMessage = { sender: "user", text: input };
                setConversation(prev => [...prev, userMessage]);
                const messageWithContext = `Mode: ${mode}, Topic: ${topic}. User says: ${input}`;
                setInput("");
                setLoading(true);
                try {
                    const res = await fetch("http://localhost:5000/chat", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ message: messageWithContext, mode: mode }),
                    });
                    if (!res.ok) throw new Error(`Server error: ${res.status}`);
                    const data = await res.json();
                    if (data.reply) {
                        setConversation(prev => [...prev, { sender: "bot", text: data.reply }]);
                    } else { throw new Error("Invalid response format."); }
                } catch (error) {
                    console.error("Fetch error:", error);
                    setConversation(prev => [...prev, { sender: "bot", text: "I'm having trouble connecting to the server. Please make sure it's running." }]);
                } finally {
                    setLoading(false);
                }
            };

            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'coffee-dark': '#2A1D17', 'coffee-med': '#34251E', 'coffee-light': '#4A372D',
                            'cream': '#FDF8F1', 'warm-bg': '#EAE0D5', 'amber-light': '#FDE68A', 'amber-dark': '#4A372D',
                        }
                    }
                }
            }

            return (
                <div className="h-screen w-screen flex bg-coffee-med font-sans">
                    <aside className="w-64 bg-coffee-dark/80 p-6 flex flex-col">
                        <div className="flex items-center gap-3 mb-10">
                            <LogoIcon className="h-7 w-7 text-amber-light" />
                            <h1 className="text-2xl font-bold text-amber-light">DSCPL</h1>
                        </div>
                        <nav className="flex flex-col space-y-3">
                            {Object.entries(modes).map(([key, { label }]) => (
                                <button
                                    key={key}
                                    onClick={() => handleModeChange(key)}
                                    className={`px-4 py-2.5 text-left rounded-lg text-lg font-semibold transition-colors duration-200 ${mode === key && view !== 'home' ? 'bg-amber-light text-amber-dark shadow-md' : 'text-amber-light/70 hover:bg-coffee-light/50 hover:text-amber-light'}`}
                                >
                                    {label}
                                </button>
                            ))}
                            <div className="pt-4 mt-4 border-t border-amber-light/10">
                                <button
                                    onClick={handleWeeklyPlanClick}
                                    className="w-full flex items-center gap-3 px-4 py-2.5 text-left rounded-lg text-lg font-semibold transition-colors duration-200 text-amber-light/70 hover:bg-coffee-light/50 hover:text-amber-light"
                                >
                                    <CalendarIcon className="h-6 w-6" />
                                    The Next Week
                                </button>
                            </div>
                        </nav>
                        <div className="mt-auto text-xs text-amber-light/30">
                            <p>Your companion for spiritual growth.</p>
                        </div>
                    </aside>
                    
                    <main className="flex-1 flex flex-col bg-warm-bg overflow-hidden">
                        {view === 'home' && (
                             <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center text-center">
                                <LogoIcon className="h-20 w-20 text-coffee-light/50 mb-6" />
                                <h1 className="text-4xl font-bold text-coffee-dark">Welcome to DSCPL</h1>
                                <p className="text-xl text-coffee-light mt-2">Your personal companion for spiritual growth.</p>
                                <p className="mt-8 text-lg text-coffee-light/80">Select a category from the sidebar to begin.</p>
                            </div>
                        )}

                        {view === 'devotion-options' && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center">
                                <h2 className="text-3xl font-bold text-coffee-dark mb-4 text-center">{modes.devotion.welcome}</h2>
                                <div className="max-w-md w-full flex flex-col gap-4 mt-6">
                                    {Object.entries(modes.devotion.options).map(([key, { title, description }], index) => (
                                        <button 
                                            key={key}
                                            onClick={() => handleDevotionOption(key)}
                                            className="p-5 bg-cream/80 rounded-lg shadow-sm text-left text-coffee-dark hover:bg-amber-light hover:shadow-md transition-all duration-200 animate-slide-in-fwd"
                                            style={{ animationDelay: `${index * 100}ms`, opacity: 0 }}
                                        >
                                            <p className="font-bold text-lg">{title}</p>
                                            <p className="text-coffee-light/80">{description}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {view === 'prayer-options' && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center">
                                <h2 className="text-3xl font-bold text-coffee-dark mb-4 text-center">{modes.prayer.welcome}</h2>
                                <div className="max-w-md w-full flex flex-col gap-4 mt-6">
                                    {Object.entries(modes.prayer.options).map(([option, description], index) => (
                                        <button 
                                            key={option}
                                            onClick={() => handlePrayerOption(option)}
                                            disabled={isGenerating}
                                            className="p-5 bg-cream/80 rounded-lg shadow-sm text-left text-coffee-dark hover:bg-amber-light hover:shadow-md transition-all duration-200 animate-slide-in-fwd disabled:opacity-70 disabled:cursor-not-allowed"
                                            style={{ animationDelay: `${index * 100}ms`, opacity: 0 }}
                                        >
                                            <p className="font-bold text-lg">{option}</p>
                                            <p className="text-coffee-light/80">{description}</p>
                                        </button>
                                    ))}
                                </div>
                                {isGenerating && <p className="mt-4 text-coffee-light animate-pulse">Generating...</p>}
                            </div>
                        )}

                        {view === 'accountability-options' && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center">
                                <h2 className="text-3xl font-bold text-coffee-dark mb-4 text-center">{modes.accountability.welcome}</h2>
                                <div className="max-w-md w-full flex flex-col gap-4 mt-6">
                                    {Object.entries(modes.accountability.options).map(([key, { title, description }], index) => (
                                        <button 
                                            key={key}
                                            onClick={() => handleAccountabilityOption(key)}
                                            disabled={isGenerating}
                                            className={`p-5 rounded-lg shadow-sm text-left text-coffee-dark transition-all duration-200 animate-slide-in-fwd disabled:opacity-70 disabled:cursor-not-allowed ${key === 'SOS Feature' ? 'bg-red-200 hover:bg-red-300' : 'bg-cream/80 hover:bg-amber-light hover:shadow-md'}`}
                                            style={{ animationDelay: `${index * 100}ms`, opacity: 0 }}
                                        >
                                            <p className="font-bold text-lg">{title}</p>
                                            <p className="text-coffee-light/80">{description}</p>
                                        </button>
                                    ))}
                                </div>
                                {isGenerating && <p className="mt-4 text-coffee-light animate-pulse">Generating...</p>}
                            </div>
                        )}

                        {view === 'meditation-structured' && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-around animate-fade-in">
                                <div className="w-full max-w-2xl text-center">
                                    <h2 className="text-2xl font-bold text-coffee-dark mb-2">Scripture Focus</h2>
                                    {isGenerating ? (
                                        <p className="text-xl text-coffee-light animate-pulse">Finding a verse for you...</p>
                                    ) : (
                                        <p className="text-xl text-coffee-light italic">"{generatedContent.data}"</p>
                                    )}
                                </div>

                                <BreathingGuide />

                                <div className="w-full max-w-2xl text-center">
                                     <h2 className="text-2xl font-bold text-coffee-dark mb-2">Meditation Prompts</h2>
                                     <p className="text-lg text-coffee-light">What does this reveal about God?</p>
                                     <p className="text-lg text-coffee-light">How can I live this out today?</p>
                                </div>
                                <button onClick={() => setView('home')} className="mt-8 px-8 py-3 bg-amber-light text-amber-dark font-semibold rounded-lg shadow-md hover:bg-amber-100 transition-colors">
                                    Finish Meditation
                                </button>
                            </div>
                        )}


                        {view === 'sos-display' && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center animate-fade-in">
                                <div className="max-w-2xl w-full bg-cream/80 p-8 rounded-lg shadow-lg text-center">
                                    <h3 className="text-2xl font-bold text-red-600 mb-4">You Are Not Alone</h3>
                                    <p className="text-xl text-coffee-light mb-4">Take a deep breath. Remember this truth: "No temptation has overtaken you except what is common to mankind. And God is faithful; he will not let you be tempted beyond what you can bear." (1 Corinthians 10:13)</p>
                                    <div className="text-left mt-6">
                                        <p className="font-bold text-coffee-dark">Immediate Action Plan:</p>
                                        <ul className="list-disc list-inside text-coffee-light">
                                            <li>Step away from the situation for 5 minutes.</li>
                                            <li>Pray this: "Lord, give me strength in this moment of weakness."</li>
                                            <li>Consider contacting a trusted friend or mentor.</li>
                                        </ul>
                                    </div>
                                </div>
                                <button onClick={() => setView('accountability-options')} className="mt-8 px-6 py-2 bg-amber-light text-amber-dark font-semibold rounded-lg shadow-md hover:bg-amber-100 transition-colors">
                                    I'm Okay For Now
                                </button>
                            </div>
                        )}

                        {view === 'content-display' && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center animate-fade-in">
                                <div className="max-w-2xl w-full bg-cream/80 p-8 rounded-lg shadow-lg text-center">
                                    {generatedContent.type === 'verse' && (
                                        <>
                                            <h3 className="text-2xl font-bold text-coffee-dark mb-4">A Verse for Strength</h3>
                                            <p className="text-xl text-coffee-light italic">"{generatedContent.data}"</p>
                                        </>
                                    )}
                                    {generatedContent.type === 'prayer' && (
                                         <>
                                            <h3 className="text-2xl font-bold text-coffee-dark mb-4">A Prayer for Today</h3>
                                            <p className="text-xl text-coffee-light">{generatedContent.data}</p>
                                        </>
                                    )}
                                    {generatedContent.type === 'error' && (
                                         <p className="text-xl text-red-500">{generatedContent.data}</p>
                                    )}
                                </div>
                                <button onClick={() => setView(mode === 'prayer' ? 'prayer-options' : 'accountability-options')} className="mt-8 px-6 py-2 bg-amber-light text-amber-dark font-semibold rounded-lg shadow-md hover:bg-amber-100 transition-colors">
                                    Back
                                </button>
                            </div>
                        )}

                        {/* This view is no longer used by Meditation */}
                        {view === 'topic-selection' && mode && (
                            <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center">
                                <h2 className="text-3xl font-bold text-coffee-dark mb-4 text-center">{modes[mode].welcome}</h2>
                                <div className="max-w-2xl w-full grid grid-cols-2 md:grid-cols-3 gap-4 mt-6">
                                    {Object.keys(modes[mode].topics).map((topicName, index) => (
                                        <button 
                                            key={topicName}
                                            onClick={() => handleTopicSelect(topicName)}
                                            className="p-4 bg-cream/80 rounded-lg shadow-sm text-lg text-coffee-dark font-semibold text-center hover:bg-amber-light hover:shadow-md transition-all duration-200 animate-slide-in-fwd"
                                            style={{ animationDelay: `${index * 80}ms`, opacity: 0 }}
                                        >
                                            {topicName}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {view === 'weekly-plan-prompt' && (
                             <div className="flex-1 p-6 sm:p-10 flex flex-col items-center justify-center text-center animate-fade-in">
                                <CalendarIcon className="h-20 w-20 text-coffee-light/50 mb-6" />
                                <h2 className="text-3xl font-bold text-coffee-dark mb-2">Begin Your 7-Day Spiritual Plan?</h2>
                                <p className="text-xl text-coffee-light max-w-2xl">{generalWeeklyPlan.goal}</p>
                                <div className="flex gap-4 mt-8">
                                    <button 
                                        onClick={handleProgramStart}
                                        className="px-10 py-3 bg-amber-light text-amber-dark text-lg font-bold rounded-lg shadow-md hover:bg-amber-100 transition-colors"
                                    >
                                        Yes, Begin
                                    </button>
                                    <button 
                                        onClick={() => setView('home')}
                                        className="px-10 py-3 bg-cream/80 text-coffee-dark text-lg font-semibold rounded-lg hover:bg-cream transition-colors"
                                    >
                                        Maybe Later
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'weekly-plan-display' && (
                            <div className="flex-1 p-6 sm:p-10 overflow-y-auto animate-fade-in">
                                <div className="max-w-2xl mx-auto text-center">
                                    <h2 className="text-3xl font-bold text-coffee-dark mb-2">Your 7-Day Spiritual Plan</h2>
                                    <p className="text-xl text-coffee-light max-w-2xl mx-auto">{generalWeeklyPlan.goal}</p>
                                    <div className="mt-8 w-full text-left">
                                        {generalWeeklyPlan.plan.map(dayInfo => (
                                            <div key={dayInfo.day} className={`p-4 mb-2 rounded-lg flex items-center gap-4 ${dayInfo.day === activeProgram.day ? 'bg-amber-light text-amber-dark' : 'bg-cream/80 text-coffee-light'}`}>
                                                <span className="font-bold text-lg">Day {dayInfo.day}</span>
                                                <div className="flex-1">
                                                    <p className="font-semibold">{dayInfo.title}</p>
                                                    <p className="text-sm opacity-80">{dayInfo.description}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}


                        {view === 'chat' && (
                            <>
                                <div className="flex-1 p-6 overflow-y-auto">
                                    <div className="max-w-3xl mx-auto">
                                        {conversation.map((msg, index) => (
                                            <div key={index} className={`flex mb-5 ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                <div className={`max-w-lg px-5 py-3 rounded-2xl shadow-sm ${msg.sender === 'user' ? 'bg-amber-light text-amber-dark rounded-br-none' : 'bg-white text-gray-800 rounded-bl-none'} ${msg.sender === 'bot' ? 'animate-bounce-in' : ''}`}>
                                                    <p className="whitespace-pre-wrap">{msg.text}</p>
                                                </div>
                                            </div>
                                        ))}
                                        {loading && (
                                            <div className="flex justify-start">
                                                <div className="px-5 py-3 rounded-2xl bg-white text-gray-800 shadow-sm rounded-bl-none animate-bounce-in">
                                                    <div className="flex items-center justify-center space-x-1.5">
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.3s]"></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.15s]"></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        <div ref={chatEndRef} />
                                    </div>
                                </div>
                                <div className="p-6 bg-white/50 border-t border-gray-200">
                                    <div className="max-w-3xl mx-auto">
                                        <form onSubmit={handleSubmit} className="flex items-center bg-white rounded-xl border-2 border-gray-200 focus-within:border-amber-400 transition-colors duration-300 shadow-sm">
                                            <input
                                                type="text"
                                                value={input}
                                                onChange={(e) => setInput(e.target.value)}
                                                placeholder={`Message about ${topic}...`}
                                                className="w-full p-4 bg-transparent text-gray-800 placeholder-gray-500 focus:outline-none"
                                            />
                                            <button type="submit" className="p-3 text-gray-500 hover:text-amber-500 transition-colors duration-200 disabled:opacity-50" disabled={loading || !input.trim()}>
                                                <SendIcon />
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </>
                        )}
                    </main>
                </div>
            );
        }

        // --- Mount the React App --- //
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
